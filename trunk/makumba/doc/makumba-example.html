<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Stefan Baebler">
   <meta name="GENERATOR" content="Mozilla/4.75 [en] (Windows NT 5.0; U) [Netscape]">
   <title>Makumba application example</title>
   <link rel="stylesheet" type="text/css" media="all" href="main.css" />
   <script language="JavasCript" src="main.js"></script>
</head>
<body>
<script language="JavaScript">
   makeNavBar("");
</script>

<h1><a NAME="Example">Makumba application example</a></h1>

This is an example for a very simple web application to illustrate the
basic princpiles of building web applications with Makumba JSP tag library.
<p>
In thi example we will build a web application for managing data about our business partners.

<h2><a name="mdd">Makumba Data Definition</a></h2>

For explanation please refer to <a href="makumba-spec.html#Data_Description">Data
Definition</a> section of the specification.

<p>File <b><tt>dataDefinitions/organisation/Partner.mdd</tt></b> (somewhere
in classpath):

<pre class="example">
name=not null char[40]    ;Name
city=char[40]       ;City
country= ptr <b>general.Country</b> ;Country
phone=char[20]      ;Phone
fax=char[40]        ;Fax
email=char[40]      ;E-Mail
homepage=char[50]   ;Home Page on the Internet
comment=text        ;Other comments
</pre>

File <b><tt>dataDefinitions/general/Country.mdd</tt></b> (somewhere in classpath):

<pre class="example">
name=char[60]             ;Country
iso2letterCode=fixed char[2];2-letter ISO code
</pre>

<h2><a name="jsp">JSP - Java Server Pages</a></h2>
For explanation please refer to <a href="makumba-spec.html#Presentation">Makumba
JSP tags</a> section of the specification.


<h3><a name="list">Listing objects</a></h3>
Page <code><b>partnerList.jsp</b></code> will be showing the list of all partners, each entry with:
<ul>
 <li>brief summary (name and city)
 <li>link to a page with more detailed information
</ul>
<pre class="example">
&lt;%@ taglib uri="<font color="#FF0000">http://www.makumba.org/presentation</font>" prefix="<font color="#FF0000">mak</font>" %>

&lt;h2>Partners:&lt/h2>

&lt;<font color="#FF0000">mak</font>:<font color="#000099">list from</font><font color="#006600">="<i>organisation.Partner p</i>"</font></font>>
   &lt;a href="partner.jsp?partner=&lt;<font color="#FF0000">mak</font>:<font color="#000099">value expr</font>=<i><font color="#006600">"p"</font></i>/>">
                &lt;<font color="#FF0000">mak</font>:<font color="#000099">value expr</font>="<i>p.name"</i>>
   &lt;/a>,
   &lt;i>&lt;<font color="#FF0000">mak</font>:<font color="#000099">value expr</font><font color="#006600">=<i>"p.city"</i></font>/>&lt;/i>  &lt;br>
&lt;/<font color="#FF0000">mak</font>:<font color="#000099">list</font>>

&lt;hr>
[&lt;a href="partnerNew.jsp">New partner entry&lt;/a>]
</pre>

If we are starting with an empty database it will be at first rendered to:

<div class="plainStyle">
<h2>Partners:</h2>
<hr>
[<a href="partnerNew.jsp">New partner entry</a>]
</div>

But once we enter some data it will look more like:

<div class="plainStyle">
<h2>Partners:</h2>
<a href="partner.jsp?partner=fg526f8">PlasticWing Airlines</a>, <i>Cambridge</i>  <br>
<a href="partner.jsp?partner=fwet4tw">Pasta al'Dente s.p.a</a>, <i>Turin</i>   <br>
<a href="partner.jsp?partner=h6e5678">Some Company Ltd.</a>, <i>Somewherewille</i>  <br>
<a href="partner.jsp?partner=456gw45">ACME gadgets</a>, <i>Death Walley</i>  <br>
<a href="partner.jsp?partner=56gfy67">Protect gamblers</a>, <i>Las Vegas</i>  <br>
<hr>
[<a href="partnerNew.jsp">New partner entry</a>]
</div>

For addit

<h3><a name="object">Object details</a></h3>
Page <code><b>partner.jsp</b></code> will be showing all fields of <code>organisation.Partner</code> objects.

<pre class="example">
&lt;%@ taglib uri="<font color="#FF0000">http://www.makumba.org/presentation</font>" prefix="<font color="#FF0000">mak</font>" %>

&lt;<font color="#FF0000">mak</font>:<font color="#000099">object from</font><font color="#006600">="<i>organisation.Partner p</i>" </font><font color="#000099">where</font><font color="#006600">=<i>"p=$partner"</i></font>>
    &lt;h2>&lt;<font color="#FF0000">mak</font>:<font color="#000099">value expr</font><font color="#006600">="p.<i>name</i>"</font>/>&lt;/h2>

    &lt;<font color="#FF0000">mak</font>:<font color="#000099">value expr</font><font color="#006600">="p.<i>city</i>"</font>/>,
      &lt;<font color="#FF0000">mak</font>:<font color="#000099">value expr</font><font color="#006600">="p.<i>country<b>.name</b></i>"</font>/>&lt;br>
    Home Page: &lt;b>&lt;<font color="#FF0000">mak</font>:<font color="#000099">value expr</font><font color="#006600">="p.<i>homepage</i>"</font>/>&lt;/b>
    &lt;p>
    You can send them an email to: &lt;<font color="#FF0000">mak</font>:<font color="#000099">value expr</font><font color="#006600">="<i>p.email</i>"</font>/>&lt;br>
    Call me: &lt;b>&lt;<font color="#FF0000">mak</font>:<font color="#000099">value expr</font><font color="#006600">="p.<i>phone</i>"</font>/>&lt;/b>&lt;br>
    Comment: &lt;<font color="#FF0000">mak</font>:<font color="#000099">value expr</font><font color="#006600">="p.<i>comment</i>"</font>/>
&lt;/<font color="#FF0000">mak</font>:object>

&lt;hr>
[&lt;a href="partnerList.jsp">List them all&lt;/a>]
</pre>

Is rendered to:
<div class="plainStyle">
<h2>Some company Ltd.</h2>
Somewherewille, Bangladesh
<br>Home Page: <b><a href="http://www.example.com">http://www.example.com</a></b>
<p>You can send them an email to: <a href="mailto:info@example.com">info@example.com</a>
<br>Call me: <b>+1 23 456789</b>
<br>Comment: They are very rich!!!
<hr>
[<a href="partnerList.jsp">List them all</a>]
</div>

Note that OQL expression <code>p.country.name</code> was evaluated to "Bangladesh" automagically. Makumba joined the Partner and Country tables when performing the query, and can make even more sophisticated table joins when needed.
<p>
For additional options see the specification of <a href="makumba-spec.html#makobject">mak:object</a> and
<a href="makumba-spec.html#makvalue">mak:value</a>.

<h3><a name="new">New object creation</a></h3>
Page <code><b>partnerNew.jsp</b></code> will require only the basic info when creating a new object:

<pre class="example">
&lt;%@ taglib uri="<font color="#FF0000">http://www.makumba.org/presentation</font>" prefix="<font color="#FF0000">mak</font>" %>

&lt;h2>New partner&lt;/h2>

&lt;<font color="#FF0000">mak</font>:<font color="#000099">newForm type</font><font color="#006600">="<i>organisation.Partner</i>" </font><font color="#000099">action</font><font color="#006600">=<i>"partnerList.jsp"</i></font>>
   Name: &lt;<font color="#FF0000">mak</font>:<font color="#000099">input field</font><font color="#006600">="<i>name</i>"</font>/> &lt;br>

   City: &lt;<font color="#FF0000">mak</font>:<font color="#000099">input field</font><font color="#006600">="<i>city</i>"</font>/> &lt;br>
   Country: &lt;<font color="#FF0000">mak</font>:<font color="#000099">input field</font><font color="#006600">="<i>country</i>"</font>/>&lt;br>
   &lt;input type="submit" value="Create">
&lt;/<font color="#FF0000">mak</font>:newForm>

&lt;hr>
[&lt;a href="partnerList.jsp">Back to list&lt;/a>]
</pre>

<div class="plainStyle">
<h2>New partner</h2>
<form action="partnerList.jsp">
   Name: <input name="name"> <br>

   City: <input name="city"> <br>
   Country: <select name="country">
   		<option>Afganisthan</option><option>Bangladesh</option><option>...</option><option>Zimbabwe</option>
   </select><br>
   <input type="submit" value="Create" onClick="alert('this is just an example'); return false;">
</form>
<hr>
[<a href="partnerList.jsp">Back to list</a>]
</div>



User can decide to omit city and country information as well, but due to <code>not null</code> attribute of field <code>name</code> in <a href="#mdd">MDD</a>, Makumba will not create a new object unless some name is specified.

<p>
For additional options see the specification of <a href="makumba-spec.html#maknew">mak:newForm</a> and
<a href="makumba-spec.html#input">mak:input</a>.

<h3>Editing existing objects</h3>
In <code><b>partnerEdit.jsp</b></code> we could edit all (non-fixed) fields, but here we decided to not support editing of some fields (Field <code>name</code> in this case)

<pre class="example">
&lt;%@ taglib uri="<font color="#FF0000">http://www.makumba.org/presentation</font>" prefix="<font color="#FF0000">mak</font>" %>

&lt;<font color="#FF0000">mak</font>:<font color="#000099">object from</font><font color="#006600">="<i>organisation.Partner p</i>" </font><font color="#000099">where</font><font color="#006600">=<i>"p=$partner"</i></font>>
   &lt;h2>Edit &lt;<font color="#FF0000">mak</font>:<font color="#000099">value expr</font><font color="#006600">="<i>p.name</i>"</font>/>&lt;/h2>
   &lt;<font color="#FF0000">mak</font>:<font color="#000099">editForm object</font><font color="#006600">="<i>p</i>" </font><font color="#000099">action</font><font color="#006600">=<i>"partnerList.jsp"</i></font>>

      City: &lt;<font color="#FF0000">mak</font>:<font color="#000099">input field</font><font color="#006600">="<i>city</i>"</font>/> &lt;br>
      Country: &lt;<font color="#FF0000">mak</font>:<font color="#000099">input field</font><font color="#006600">="<i>country</i>"</font>/>&lt;br>
      Home Page: &lt;<font color="#FF0000">mak</font>:<font color="#000099">input field</font><font color="#006600">="<i>homepage</i>"</font>/>
      &lt;p>
      Email: &lt;<font color="#FF0000">mak</font>:<font color="#000099">input field</font><font color="#006600">="<i>email</i>"</font>/>&lt;br>
      Phone: &lt;<font color="#FF0000">mak</font>:<font color="#000099">input field</font><font color="#006600">="<i>phone</i>"</font>/>&lt;br>
      Comment: &lt;<font color="#FF0000">mak</font>:<font color="#000099">input field</font><font color="#006600">="<i>comment</i>"</font>/>&lt;br>
      &lt;input type="submit" value="Save">
   &lt;/<font color="#FF0000">mak</font>:editForm>

   &lt;<font color="#FF0000">mak</font>:<font color="#000099">delete object</font><font color="#006600">="<i>p</i>" </font><font color="#000099">action</font><font color="#006600">=<i>"partnerList.jsp"</i></font>>Delete this&lt;<font color="#FF0000">mak</font>:<font color="#000099">delete</font>>

&lt;/<font color="#FF0000">mak</font>:object>

&lt;hr>
[&lt;a href="partnerList.jsp">Back to list&lt;/a>]
</pre>

<div class="plainStyle">
<h2>Edit Some Company Ltd.</h2>
<form action="partnerList.jsp">
   City: <input name="city" value="Somewherewille"> <br>
   Country: <select name="country"/>
   		<option>Afganisthan</option><option SELECTED>Bangladesh</option><option>...</option><option>Zimbabwe</option>
   </select><br>
   Home Page: <input name="homepage" value="http://www.example.com">
   <p>
   Email: <input name="email" value="info@example.com"><br>
   Phone: <input name="phone" value="+1 23 456789"><br>
   Comment: <textarea name="comment">They are very rich!!!</textarea><br>

   <input type="submit" value="Save" onClick="alert('this is just an example'); return false;">
</form>
<a href="partnerList.jsp" onClick="alert('this is just an example'); return false;">Delete this</a>
<hr>
[<a href="partnerList.jsp">Back to list</a>]
</div>


<p>
For additional options see the specification of <a href="makumba-spec.html#makedit">mak:editForm</a> and
<a href="makumba-spec.html#input">mak:input</a>.


<h3>Fine-tuning layout</h3>
Always make things work first, then bother with details.

<p>In order to keep your code as clean as possible, we advise you to break it
down into small, human-managable files and include them in your pages with
&lt;jsp:include /> directive, eg:
<pre class="example">
&lt;jsp:include page="header.jsp"/>
</pre>
You can also take some size of the .jsp files and improve their readability by seperating the layout specification into  seperate <a href="http://www.w3.org/Style/CSS/">Cascading Style Sheets</a>.

<h2>Business Logic</h2>
...coming soon...

<script language="JavaScript">
   makeFooter("$Id$");
</script>

</body>
</html>
