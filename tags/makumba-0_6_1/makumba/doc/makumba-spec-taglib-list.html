<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="author" content="makumba-dev group">
  <title>Makumba Specification</title>
  <link rel="stylesheet" type="text/css" media="all" href="main.css">
  <script type="text/javascript" src="main.js"></script>
</head>
<body>
<script type="text/javascript">
   makeNavBar("");
</script>
<h1>Makumba Specification</h1>

<table>
  <tr>
    <td valign="top"> <a href="makumba-spec.html" title="...writing MDDs"><b>[Data Definitions]</b></a>&nbsp; </td>
    <td valign="top"> <a href="makumba-spec-ql.html" title="...getting data from the database"><b>[Query Languages]</b></a>&nbsp; </td>
    <td valign="top"> 
      <b>[<span title="...viewing/editing data thru HTML pages">JSP tag library</span>:</b>
      <a href="makumba-spec-taglib.html" title="...controller &amp; response"><b>Intro</b></a>
      | <a href="makumba-spec-taglib-list.html" title="...viewing data thru HTML pages"><b>Listing</b></a>
      | <a href="makumba-spec-taglib-forms.html" title="...editing data thru HTML pages"><b>Forms</b></a>]
    </td>     
    <td valign="top"> <a href="makumba-spec-bl.html" title="...adding logic to basic operations"><b>[Business Logics]</b></a>&nbsp; </td>
    <td valign="top"> <a href="makumba-spec-summary.html" title="...Presentation and internal representation principles"><b>[Summary]</b></a> </td>
  </tr>
</table>


<h2><a name="Presentation">JSP taglib - listing</a></h2>


<table widht=100%>
<tr>
  <td valign="top">
    <div class="navbarPage">
    <ul class="navbarPage">
      <li><a href="#makobject">&lt;mak:object&gt;</a></li>
      <br>
      <li><a href="#usageOFAttributes">Attributes and OQL in &lt;mak:list&gt; and &lt;mak:object&gt;</a></li>
      <br>
      <li><a href="#makvalue">&lt;mak:value/&gt;</a></li>
      <br>
      <li><a href="#makcount">mak:count(), mak:maxCount(), mak:lastCount()</a></li>
      <br>
      <li><a href="#makif">&lt;mak:if&gt;</a></li>
      <br>
      <li><a href="#mak_attrib">&lt;mak:attribute&gt;</a></li>
    </ul>
    </div>
  </td>
  <td>


<h3><a name="maklist">&lt;mak:list...&gt;...&lt;/mak:list&gt;</a></h3>
<p>
Performs a query on the database. The body of the list, if present, is
run
once for every item in the resulting data (size 0..N), e.g. to display
it.
Queries are generated on the spot and can be nested.
</p>
<p>Example:</p>
<pre class="example">&lt;mak:list from="best.Student s, s.person p" where="p.gender=\"male\""<br>          orderBy="p.name"&gt;<br><br>    &lt;c:if test="${mak:count()==1}"&gt;<br>       &lt;p&gt; There are ${mak:maxCount()} male students:<br>    &lt;/c:if&gt;<br><br>    &lt;br&gt; &lt;%= counter %&gt;.<br>    &lt;mak:value expr="p.name"/&gt;<br>    &lt;mak:value expr="p.surname"/&gt; &lt;br&gt;<br>    &lt;mak:list from="p.addresses a"&gt;<br>       &lt;mak:value expr="a.streetno"/&gt; &lt;mak:value expr="a.city"/&gt;<br>    &lt;/mak:list&gt;<br>&lt;/mak:list&gt;<br><br>&lt;c:if test="${mak:lastCount()==0}"&gt; There are no male students. &lt;/c:if&gt;<br></pre>
<p>
</p>
<table class="tagParamDef">
  <tbody>
    <tr>
      <th>tag parameter</th>
      <th>description</th>
      <th>comments</th>
    </tr>
    <tr>
      <td><tt>db</tt></td>
      <td>The makumba database to connect to. The format is <code><i>Host_SQLEngineType_DatabaseName</i></code>
      <br>
If not present, the default database is used.
See <a href="SQL-drivers.html">database
configuration and lookup</a>.</td>
      <td>Fixed, cannot contain attributes, for now. <br>
The default database is chosen if this argument is not set. <br>
Can only be set for top-level (root) query tags<br>
Can be a Rtexpr &lt;%= ...%&gt;</td>
    </tr>
    <tr>
      <td><tt>from</tt></td>
      <td><a href="#OQL">OQL FROM</a> section. If the query is nested,
the keys from the parent's query are added to this FROM section in the
resulting query</td>
      <td>Fixed, Mandatory.</td>
    </tr>
    <tr>
      <td><tt>variableFrom</tt></td>
      <td>supplementary, variable <a href="#OQL">OQL FROM</a> section.</td>
      <td>Fixed, can contain #{ JSP EL expressions }</td>
    </tr>
    <tr>
      <td><tt>where</tt></td>
      <td><a href="#OQL">OQL WHERE</a> section. If the query is nested,
the WHERE section from the parent's query, is added to this in the
resulting query</td>
      <td>Fixed, can contain #{ JSP EL expressions }</td>
    </tr>
    <tr>
      <td><tt>groupBy</tt></td>
      <td><a href="#OQL">OQL GROUP BY</a>&nbsp; section</td>
      <td>Fixed, can contain #{ JSP EL expressions }</td>
    </tr>
    <tr>
      <td><tt><span class="futfeat">(having)</span></tt></td>
      <td><span class="futfeat"><a href="#OQL">OQL HAVING</a>&nbsp;
section</span></td>
      <td><span class="futfeat">Fixed</span></td>
    </tr>
    <tr>
      <td><tt>orderBy</tt></td>
      <td><a href="#OQL">OQL ORDER BY</a>&nbsp; section</td>
      <td>Fixed, can contain #{ JSP EL expressions } <tt
 class="oldfeat">label.$fieldname used to be supported, not anymore</tt></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>offset</tt></td>
      <td style="vertical-align: top;">the offset of the result to show
(0 for starting from the first result)<br>
      </td>
      <td style="vertical-align: top;">Fixed ($attribute allowed). Only
allowed for the outermost mak:list<br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>limit</tt></td>
      <td style="vertical-align: top;">the maximum numbers of results
to show (-1 for all results)<br>
      </td>
      <td style="vertical-align: top;">Fixed ($attribute allowed). Only
allowed for the outermost mak:list. <br>
      <span class="futfeat">LIMIT can limit the query time
dramatically, but the children mak:lists are not yet limited.</span><br>
      </td>
    </tr>
    <tr>
      <td><tt class="oldfeat">countVar</tt></td>
      <td><span class="oldfeat">The <code>java.lang.Integer</code>
variable that will
contain the number of the current
iteration.</span> </td>
      <td><span class="oldfeat">Fixed. A new Java variable is created,
so no other variable
by the same name can exist in the Java scope at that point in the JSP.
Deprecated, use mak:count() expression language function instead</span></td>
    </tr>
    <tr>
      <td><tt class="oldfeat">maxCountVar</tt></td>
      <td><span class="oldfeat">The <code>java.lang.Integer</code>
variable that will
contain the total number of iterations.</span></td>
      <td><span class="oldfeat">Fixed. A new Java variable is
created, so no other variable
by the same name can exist
in the Java scope at that point in the JSP. Deprecated,
use mak:maxCount() expression language function instead</span></td>
    </tr>
    <tr>
      <td><tt class="oldfeat">separator</tt></td>
      <td> <span class="oldfeat">Character string as separator between
two list elements.
It is not included before the first or after the last</span><span
 class="oldfeat"></span></td>
      <td><span class="oldfeat">D</span><span class="oldfeat"></span><span
 class="oldfeat">eprecated,
use &lt;c:if test="${mak:count&lt;mak:maxCount()}"&gt; instead</span>.</td>
    </tr>
    <tr>
      <td><tt>id</tt></td>
      <td>Tag's identifier</td>
      <td>Fixed. Can be used to distinguish otherwise identical tags on
a page
(to avoid confusion by Makumba's JSP analyser)</td>
    </tr>
  </tbody>
</table>
<h4>
<a name="makobject">&lt;mak:object&nbsp; ...&gt;.... &lt;/mak:object&gt;</a></h4>
<p>
Like list, but the query can only have zero or one result. A zero value
for <code>maxCountVar</code> and <code>countVar</code> indicate that
the object does not exist.
</p>
<p>Example: See <a href="#maklist"><code>&lt;mak:list&gt;</code></a>.
</p>
<!-- FIXME; fred: "this needs to be rewritten, assuming no knowledge of the concept of jsp attributes,

                   thus with an intro on the subject. Explaining the diff between Java scope and Attribute scope." -->
<h4><a name="usageOFAttributes">Attributes and OQL</a> in &lt;mak:list
&gt; and
&lt;mak:object &gt;</h4>
<p>
Attributes are accessible through <code>$AttributeName</code>
to any makumba tag. Typically they will be present in OQL sections
instead
of <code>$number</code> attributes (therefore the OQL sections of
these tags is not
"pure"). For example:
</p>
<pre class="example">&lt;mak:list from="best.internal.Lbg"<br>          where="lbg.country=$country"<br>          orderBy="lbg.$lbg_order"&gt;<br>  .....<br>&lt;/mak:list&gt;<br></pre>
<p>If a <code>$</code> (dollar) sign needs to be in the string, the
escape is <code>$$</code>.
<br>
If at the end of an attribute there has to be a Java identifier letter,
the attribute name can be written as <code>text1$attrName$text2</code>,
that is,
with <code>$</code> at both ends.
</p>
<p>The http parameters are automatically set as page
attributes. Other attributes can be set by the Java code as attributes
in any scope
(page, request, session, application) using
<code><a title="external link, servlet API"
 href="http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/jsp/PageContext.html">pageContext.setAttribute(name,
value, scope)</a></code>.
</p>
<p>The query generator is setting all the attributes
that are logically possible as prepared query parameters. For example,
the $country above is a query parameter since it's a value, but the
$lbg_order
will not be accepted as query parameter, since it's a field name.
</p>
<p>If an attribute has multiple values, it is expanded
into multiple OQL parameters. For example:
</p>
<pre class="example">&lt;mak:list from="best.internal.Lbg" where="lbg.status in set($status)" &gt;<br></pre>
<p>
</p>
<div class="futfeat"> (For view-level attributes such as lbg_order
above, the value range can be defined by : <br>
&nbsp;&nbsp;&nbsp;<code>&lt;mak:defineAttribute name="lbg_order"
values="name, id" default="name"/&gt;</code> )
<p>(Later: Maybe the page might want to set attributes. Something like
: <br>
&nbsp;&nbsp;&nbsp;<code>&lt;mak:setAttr name="lbg"
from="best.internal.Lbg lbg" where ... scope="session" /&gt;</code>
<br>
Then the attribute could be used as <code>$lbg</code> in the rest of
the page/session/application... Con: such stuff is normally done by the
Java code. )</p>
</div>
<h4><a name="makvalue">&lt;mak:value&nbsp; .../&gt;</a></h4>
<p>
Displays the value of an expression from within the query.
</p>
<p>
Example:
</p>
<pre class="example">&lt;mak:list from="best.Student s, s.person p"<br>	where="p.gender=\"male\"" orderBy="p.name"&gt;<br>    &lt;mak:value expr="p.name"/&gt;<br>    &lt;mak:value expr="p.surname"/&gt;<br>    &lt;mak:value expr="p.birthdate" var="birth" printVar="printBirth"/&gt;<br>    &lt;% // we only print the birthdate if it's after some date<br>         if ( ((java.util.Date)birth).after(new java.util.Date(1980, 0, 1)) )<br>             out.print(printBirth);<br>    %&gt;<br>    &lt;mak:value expr="s.person.favoriteQuote" maxLength="60" addTitle="auto" /&gt;<br>&lt;/mak:list&gt;</pre>
<br>
<p>
</p>
<table class="tagParamDef">
  <tbody>
    <tr>
      <th>tag parameter</th>
      <th>description</th>
      <th>comments</th>
    </tr>
    <tr>
      <td><tt>expr</tt></td>
      <td><a href="#OQL">OQL SELECT</a> projection expression.
It will be displayed if <code>var</code> nor <code>printVar</code>
are
not specified.</td>
      <td>Fixed, Mandatory.</td>
    </tr>
    <tr>
      <td><tt>var</tt></td>
      <td>The value of the expression is set to a new <code>java.lang.Object</code>
variable by this name, as
well as to a page-scope attribute, also by the same name (accessible as
      <code>$attributename</code>). </td>
      <td>Fixed. A new Java variable is created, so no other variable
by the same name can
exist in the Java scope at that point in the JSP. <br>
Note: the Java variable must be cast to its specific type (Integer,
String,
Date, Text, Pointer, Vector) before using it as such. </td>
    </tr>
    <tr>
      <td><tt>printVar</tt></td>
      <td>The formatted output as it would have been printed, is
instead stored in a new <code>java.lang.String</code>
variable by this name, as well as to a page-scope attribute by the same
name (accessible as <code>$attributename</code>). </td>
      <td>Fixed. A new Java variable is created, so no other variable
by the same name can
exist in the Java scope at that point in the JSP. </td>
    </tr>
    <tr>
      <td><tt>urlEncode</tt></td>
      <td>Indicates if the expression will be part of an URL or not. If
"true", the output is URL-encoded. Default is "false". </td>
      <td>Rtexpr.</td>
    </tr>
    <tr>
      <td><tt>html</tt></td>
      <td>Normal behaviour is to transform character output to its HTML
escaped form.
If this is "<code>true</code>", content is assumed to be HTML, and is
not escaped.
If "<code>auto</code>", heuristically checks the content for HTML tags
and inhibits escape if there are any.
Default is "<code>false</code>".</td>
      <td>Rtexpr. Only char[] and text</td>
    </tr>
    <tr>
      <td><tt>format</tt></td>
      <td>Format string to specify the formatting of a date value,
according to <code><a title="external link, servlet API"
 href="http://java.sun.com/j2se/1.4.2/docs/api/java/text/SimpleDateFormat.html">java.text.SimpleDateFormat</a></code>
      </td>
      <td>Rtexpr. Only for date. Defaults to "<code>dd MMMM yyyy</code>"</td>
    </tr>
    <tr>
      <td><tt>lineSeparator</tt></td>
      <td>Separator for long lines. If a text consists of short lines
only, it will be surrounded by <code>&lt;pre&gt;...&lt;/pre&gt;</code>.
Default is "<code>&lt;p&gt;</code>".</td>
      <td>Rtexpr. Only for text. Current implementation is <a
 href="http://bugzilla.makumba.org/show_bug.cgi?id=38">buggy</a>:
separator is added before every long line, instead of between every
long line.</td>
    </tr>
    <tr>
      <td><tt>longLineLength</tt></td>
      <td>The length of a long line. If a text contains long lines, it
will be
printed differently. See <code>lineSeparator</code>. Default is "30"</td>
      <td>Rtexpr. Only for text.</td>
    </tr>
    <tr>
      <td><tt>maxLength</tt></td>
      <td>The maximum length (number of characters) to print. Longer
output is cut off, and an <code>ellipsis</code>
is added to indicate the cut. If not set (default), there is no maximum.</td>
      <td>Rtexpr. Only applies for char[] AND if it is not already HTML
formatted (cfr. <code>html</code>).</td>
    </tr>
    <tr>
      <td><tt>ellipsis</tt></td>
      <td>The character string to print to indicate that the text
extended the <code>maxLength</code>. Default is "...".
The final printed string, including the <code>ellipsis</code>, will
not exceed <code>maxLength</code>.</td>
      <td>Rtexpr</td>
    </tr>
    <tr>
      <td><tt>ellipsisLength</tt></td>
      <td>The equivalent character length of <code>ellipsis</code>.
By default, this is the number of characters in <code>ellipsis</code>.
But if <code>ellipsis</code> is e.g. HTML code, then that is not
appropriate. </td>
      <td>Rtexpr. <br>
      <u>Example</u>, the ellipsis is an image of approx 3 characters
wide. <code>ellipsis="&lt;img src=icon.gif width=10 height=10&gt;"
ellipsisLength="3"</code> </td>
    </tr>
    <tr>
      <td><tt>addTitle</tt></td>
      <td>If "<code>true</code>", add an HTML tooltip with the value,
to the
printed output.
If "<code>auto</code>", add tooltip only if the printed output
is cut (cfr <code>maxLength</code>). Default is "<code>false</code>". <br>
      </td>
      <td>Rtexpr.
Note: implementated by producing as output: <code>&lt;span title="<i>printVar</i>"&gt;<i>possibly-cut-printVar</i>&lt;/span&gt;</code>
      </td>
    </tr>
    <tr>
      <td><tt>default</tt></td>
      <td>The character string to print if the <code>expr</code>
results in a NULL value. Default is <code>default=""</code> (i.e.
zero-length string)<br>
Support not available for: date, "choice" = ptr, set, setCharEnum<!-- bug 501-->
      </td>
      <td>Rtexpr</td>
    </tr>
    <tr>
      <td><tt>empty</tt></td>
      <td>The character string to print if the normal printed output
would be empty (i.e. zero-length string).
Therefore, this is also used for case <code>expr=NULL</code> and <code>default=""</code>.</td>
      <td>Rtexpr<br>
      </td>
    </tr>
  </tbody>
</table>
<h4><a name="makcount">mak:count(), mak:maxCount(), mak:lastCount()</a></h4>
These are JSP EL (expression language) functions that give information
about the iterations in a list.
<ul>
  <li> mak:count() gives the number of the current iteration inside a
mak:list or mak:object. It has no value outside that tag. </li>
  <li> mak:maxCount() gives the total number of iterations inside a
mak:list or mak:object (1). It has no value outside that tag. </li>
  <li> mak:lastCount() gives the total number of iterations of the
previous mak:list or mak:object, respectively. It has no value inside
the mak:list/object.
    <div class="note">Note: if you want to store the value of some
mak:list/object
for usage in/after a later mak:list/object, you can do that with
&lt;c:set var="<i>someVariableName</i>" value="${mak:lastCount()}" just
after that
mak:list/object.</div>
  </li>
</ul>
Example using the Java Standard Tag Library (<a
 href="http://java.sun.com/products/jsp/jstl/">JSTL</a>, prefix "c"): <br>
<pre class="example">&lt;mak:list ...&gt;<br>   &lt;c:if test="${mak:count()==1}"&gt;These are the list elements: &lt;/c:if&gt;<br>   &lt;tr bgcolor="${mak:count()%2==1?"white":"grey"}"&gt;<br>       &lt;td&gt;this shows in alternative colors&lt;/td&gt;<br>   ...<br>   &lt;c:if test="${mak:count()!=mak:maxCount()}"&gt;<br>       a separator where we can have any &lt;b&gt;tag&lt;/b&gt; <br>       we don't want separators to be shown after the last element <br>   &lt;/c:if&gt;<br>&lt;/mak:list&gt;<br>&lt;c:if test="${mak:lastCount()==0}"&gt;These are no elements &lt;/c:if&gt;<br></pre>
<h4><a name="makif">&lt;mak:if&nbsp; ...&gt; ... &lt;/mak:if&gt;</a></h4>
<p>
Displays the body of the tag only if the OQL expression evaluates to
true.
</p>
<p>
Example :
</p>
<pre class="example">&lt;mak:list from="best.Student s"<br>	  where="s.person.birthdate &lt;&gt; nil" orderBy="s.name"&gt;<br>   &lt;mak:value expr="s.person.name"/&gt;<br>   &lt;mak:if test="s.person.hideAge = 0"&gt;<br>      was born on &lt;mak:value expr="s.person.birthdate" /&gt;<br>   &lt;/mak:if&gt;<br>&lt;/mak:list&gt;<br></pre>
<br>
<p>
</p>
<table class="tagParamDef">
  <tbody>
    <tr>
      <th>tag parameter</th>
      <th>description</th>
      <th>comments</th>
    </tr>
    <tr>
      <td><tt>test</tt></td>
      <td>
      <p><a href="#OQL">OQL SELECT</a>&nbsp; projection expression. It
must be a test, resulting in a 'boolean' in SQL : 0 or 1. </p>
      <p>for the test expressions: =, !=, &lt;, &lt;=, &gt;, &gt;=</p>
      </td>
      <td>Fixed, Mandatory. <br>
      <i>(in first implementation, this was called <code>expr</code>,
but changed to reflect practice in XSL and <a
 href="http://java.sun.com/products/jsp/jstl/"
 title="JSP Standard Tag Library">JSTL</a>)</i> </td>
    </tr>
  </tbody>
</table>
<h4><a name="mak_attrib">&lt;mak:attribute&nbsp; .../&gt;</a></h4>
<!-- when bug 64 is fixed uncomment this:

<b>DEPRECATED</b>, use <a href="#makvalue">&lt;mak:value></a> instead, like:

<pre class="example">

&lt;mak:value expr="$pattern" ... />

</pre>

<p>

-->
<p>Displays the value of an attribute, or sets it to a Java variable.
</p>
<p>
Example:
</p>
<pre class="example">&lt;mak:attribute name="pattern" var="pattern" exceptionVar="exception"/&gt;<br><br>&lt;% if (exception!=null) {<br>     pageContext.setAttribute("pattern", (String)pattern+"%");<br>%&gt;<br>   &lt;mak:list from="type t" where="t.field like $pattern" &gt;...&lt;/mak:list&gt;<br><br>&lt;% } else { %&gt;<br>   No pattern argument. Please indicate one.<br>&lt;% } %&gt;<br></pre>
<br>
<p>
</p>
<table class="tagParamDef">
  <tbody>
    <tr>
      <th>tag parameter</th>
      <th>description</th>
      <th>comments</th>
    </tr>
    <tr>
      <td><tt>name</tt></td>
      <td>the name of the attribute. Will be printed if <tt>var </tt>is
not present
and there is no exception when finding the argument. If there is an
exception
but <tt>exceptionVar</tt> is indicated, nothing will be printed.</td>
      <td>Fixed, Mandatory.</td>
    </tr>
    <tr>
      <td><tt>var</tt></td>
      <td>The name of the <code>java.lang.Object</code> variable where
to store the attribute value.
Note that you will have to cast it to its specific type.</td>
      <td>Fixed</td>
    </tr>
    <tr>
      <td><tt>exceptionVar</tt></td>
      <td>The name of the created <code>java.lang.Throwable</code>
variable that will
hold eventual exceptions
raised when trying to compute the attribute. If <code>exceptionVar</code>
is missing,
any raised exception will stop page execution. If it is present, and <code>AttibuteNotFoundException</code>
occurs, the attribute is set to <code>null</code> (so a next request
for the attribute
will return <code>null</code>)</td>
      <td>Fixed</td>
    </tr>
    <tr>
      <td><tt>db</tt></td>
      <td>The database in which the business logic (if any) will
compute the
attribute. The default database is normally used.</td>
      <td>Fixed</td>
    </tr>
  </tbody>
</table>    
 

  </td>
</tr>
</table>

<script type="text/javascript">
   makeFooter("$Id$");
</script>
</body>
</html>
 