<!-- Mak-specific customization for Maven
http://maven.apache.org/using/customising.html
http://maven.apache.org/reference/scripting.html
-->
<project xmlns:ant="jelly:ant">
  <preGoal name="java:compile">
    <ant:tstamp>
	<format property="CURDATE" pattern="yyyyMMddHHmmss" locale="en"/> 
    </ant:tstamp>
    <ant:echo message="buildDate=${CURDATE}" file="classes/org/makumba/versionBuildDate.properties"/> 
  </preGoal>

  <preGoal name="jar:jar">
    <ant:java classname="org.makumba.version" fork="true" output="manifest-replace.properties" dir="${basedir}">   
        <classpath>
	<pathelement path="target/classes/"/>
	<pathelement path="${java.class.path}"/>
	</classpath>
    </ant:java>

    <ant:filter token="user" value="${user.name}"/>
    <ant:filter filtersfile="manifest-replace.properties"/>

    <!-- Copy the manifest in order to replace the version token filter -->
    <ant:copy file="manifest.template" tofile="manifest.mf" filtering="on" overwrite="true" dir="${basedir}"/>
    <ant:copy file="servlet_context/WEB-INF/makumba.tld" todir="target/classes/META-INF" filtering="on" overwrite="true" dir="${basedir}"/>
    <ant:copy file="servlet_context/WEB-INF/makumba-hibernate.tld" todir="target/classes/META-INF" filtering="on" overwrite="true" dir="${basedir}"/>
    <ant:copy file="META-INF/makumba.tld" tofile="target/classes/META-INF/taglib.tld" filtering="off" overwrite="true" dir="${basedir}"/>
    <ant:copy file="META-INF/makumba-hibernate.tld" tofile="target/classes/META-INF/taglib.tld" filtering="off" overwrite="true" dir="${basedir}"/>
  </preGoal>
</project>
