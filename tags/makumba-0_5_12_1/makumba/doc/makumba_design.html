<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>Makumba Design</title>
  <link rel="stylesheet" type="text/css" media="all" href="main.css">
</head>
<body>
<h1>Makumba design</h1>
<h2>Statement of purpose </h2>
<h3>What do we design makumba for?</h3>
<p>(should be put in sentences and posted on www.makumba.org)<br>
</p>
<ul>
  <li>fast member involvement</li>
  <li>rapid development<br>
  </li>
  <li>based on members' HTML and <a href="http://sqlzoo.net/" target="_blank">SQL</a> knowledge</li>
  <li>unlike popular scripting languages, it still enforces a clean
model-view-controller (<a href="http://heim.ifi.uio.no/~trygver/themes/mvc/mvc-index.html" target="_blank">MVC</a>)
architecture, leading to a healthy structure of the applications even
as members come and go</li>
  <li>db-driven web applications (clear delimitation of the technology)</li>
  <li>simple (few concepts)</li>
  <li>source code should be clear and easy readable to ensure efficient
learning by example for new members<br>
  </li>
  <li>easy to install (few commands/directories/files to work with)</li>
  <li>independent of any commercial technology or data format (easy to
migrate to other technologies that can access databases through <a href="http://sqlzoo.net/" target="_blank">SQL</a>)<br>
  </li>
  <li>as much as possible "compiled" rather than interpreted (tell the
developer at first page execution that somthing is rotten, rather than
wait for it to blow in production)<br>
  </li>
  <li>personal member development towards java, <a href="http://heim.ifi.uio.no/~trygver/themes/mvc/mvc-index.html" target="_blank">MVC</a>, <a href="http://www.w3.org/Protocols/rfc2616/rfc2616.html" target="_blank">http</a>, JSP and
other technologies involved<br>
  </li>
</ul>
<h2>The issue of design</h2>
the biggest issue with makumba today is design. <br>
reasons:<br>
<ul>
  <li>design is originality: if makumba design weren't original, there
would be no need for makumba, sth else could be used<br>
  </li>
  <li>there was a lot of pressure to stop design and start
implementation, so some parts of makumba are still poorly designed
(while others give its strength and originality)<br>
  </li>
  <li>a lot of stuff had to be implemented from scratch as the standard
or 3rd party technologies at the time (1999-2001) were non-existent, in
bad shape, or uncertain. Even the ubiquitous <a href="http://jakarta.apache.org/tomcat/" target="_blank">Tomcat</a> did not exist at
the time, and JSP was in its conceiving stages</li>
</ul>
<h2>Objectives of makumba design work</h2>
we should adjust the makumba design so that:<br>
<ul>
  <li>keeps its strength and originality as expressed in the statement
of purpose above</li>
  <li>makes better use of 3rd party technology (especially
java-endorsed standards), taking advantage of their healthy design,
reliability and 'standardness'. <br>
  </li>
  <li>in components where makumba is still considered more original, or
3rd party technologies are still unsatisfactory, publish the respective
part of makumba as a separate, original product</li>
  <li>this will lead to a smaller, easier to maintain, and more
reliable makumba. <br>
  </li>
  <li>eliminating sluggish design will make us more proud and ready to
better promote makumba in the open-source world</li>
</ul>
as such, what we need to do now, is search literature and read, not
write code, except where design is straight-forward and experience from
karamba and other applications clearly shows that a feature is needed,
and can't wait much for redesign.<br>
<span style="font-weight: bold;"></span>
<h2>3rd party technologies</h2>
<h3><span style="font-weight: bold;"></span>how to look at a technology:</h3>
<ul>
  <li>is it used by makumba already? if so, does makumba use it to its
full potential (e.g. it may be that makumba adopted the technology
early in its development)</li>
  <li>if not, what would it do for makumba, in which area?</li>
  <li>try out the technology. install it and do an example <br>
  </li>
  <li>is it a standard? would it be good for best members' personal
development to learn it?<br>
  </li>
  <li>would the overhead (in installation/configuration, data
conversion, etc) of using that technology be acceptable? would the
development process (makumba usage) be easier? even if it would be a
bit more difficult, are the other advantages important enough?<br>
  </li>
  <li>in general, how will makumba+that technology respect the
statement of purpose?</li>
</ul>
<h3>technologies used by makumba today, and their versions</h3>
<ul>
  <li><a href="http://java.sun.com/" target="_blank">Java</a> of course. the latest 1.5 version brings a lot of useful
stuff, e.g. for business logic code (e.g. using int and Integer
interchangeably i.e. autoboxing)</li>
  <li><a href="http://www.antlr.org/" target="_blank">antlr</a>: used to parse OQL. transparent for the makumba user. We
went through antlr  2.7.1 and 2.7.2. only 2.7.2 works with <a href="http://www-124.ibm.com/developerworks/oss/jikes/" target="_blank">Jikes</a> 1.18
(see below)<br>
  </li>
  <li><a href="http://www.junit.org/" target="_blank">Junit</a>: used to test makumba. transparent for the makumba user</li>
  <li>JSP: used to implement the taglib. mostly 1.1 is used (though 2.0
brings lots of useful stuff for the makumba user)</li>
  <li><a href="http://java.sun.com/products/servlet/" target="_blank">servlet</a>: used to filter requests (the mak controller), display
errors, etc. servlet 2.2 was not supporting filters, we introduced that
with servlet 2.3<br>
  </li>
  <li>both JSP and servlet need a servlet container, we use <a href="http://jakarta.apache.org/tomcat/" target="_blank">Tomcat</a> for
that. it's not always transparent for users. We went through Tomcat  3,
4 and 4.1. Tomcat 5 is now up, supporting JSP 2.0 and servlet 2.4</li>
  <ul>
    <li><a href="http://jakarta.apache.org/tomcat/tomcat-5.0-doc/jasper-howto.html" target="_blank">Jasper</a> (the JSP compiler) is an important part of&nbsp; Tomcat.
Jasper 2 was introduced with 
Tomcat  4.1. generally transparent for the
user as long as makumba is not producing errors <br>
    </li>
  </ul>
  <ul>
    <li>Jikes is a fast java compiler, used to compile Java code
generated by Jasper (and to compile makumba code itself). <a href="http://www-124.ibm.com/developerworks/oss/jikes/" target="_blank">Jikes</a> is
fully interchangeable with Java's normal javac compiler, but it's
faster. only Jikes 1.18 works with Jasper  2 due to the <a href="http://java.sun.com/developer/technicalArticles/Intl/Supplementary/" target="_blank">UTF</a>
character coding. transparent for the user, only needs installation<br>
    </li>
  </ul>
  <li><a href="http://java.sun.com/products/jdbc/" target="_blank">JDBC</a>: to connect to databases. makumba hides a lot of its
details. JDBC's original goal (version 1) was to be able to connect to
a database at all (i.e. try to support as many as possible, not
necessarily in an uniform manner). Database neutrality is more
important for JDBC  2 and 3. These versions also provide features that
may speed up makumba internals.</li>
  <li>DB engines. in general transparent for the user, as part of DB
neutrality<br>
  </li>
  <ul>
    <li><a href="http://dev.mysql.com/doc/" target="_blank">MySQL</a> is the main DB engine supported by makumba. we went from
version 3.23 to version 4.0, then we started using <a href="http://www.innodb.com/index.php" target="_blank">InnoDB</a> tables
instead of <a href="http://dev.mysql.com/doc/mysql/en/MyISAM.html" target="_blank">MyISAM</a> tables. <a href="http://www.mysql.com/products/maxdb/" target="_blank">MaxDB</a> tables seem also to be interesting for
some fatures. <a href="http://dev.mysql.com/doc/" target="_blank">MySQL</a> 4 (4.1?) brings interesting features like
subqueries, multi-table updates. <br>
    </li>
    <li>other DB engines that makumba was tested with: <a href="http://www-306.ibm.com/software/data/informix/" target="_blank">Informix</a>, <a href="http://www-306.ibm.com/software/data/db2/" target="_blank">DB2</a>,
<a href="http://www-306.ibm.com/software/data/cloudscape/" target="_blank">Cloudscape</a> (recently open-sourced by IBM), partly <a href="http://www.microsoft.com/resources/documentation/sql/7/all/proddocs/en-us/msjet/jetintro.mspx" target="_blank">ODBCJet</a> on windows<br>
    </li>
    <li>mysql-connectorJ, the JDBC driver used by makumba, presently
used version is 3.0.7, which is compatible with JDBC 3.0, there are
more advanced versions of it (3.0.14, 3.1), supporting pretty recent
JDBC features.<br>
    </li>
  </ul>
  <li><a href="http://ant.apache.org/" target="_blank">Ant</a>: used to build and publish makumba. mostly transparent for
the user as far as makumba is concerned (Ant  is also used in karamba,
but that's another story). We went from Ant 1.3 to 1.6, increasingly
using its new features</li>
</ul>
<h1>Makumba components and their design status</h1>
<h2>mak:list engine</h2>
<h3>design status:</h3>
<ul>
  <li>this is clearly the most original and
powerful part of makumba.</li>
  <li>familiarity with <a href="http://sqlzoo.net/" target="_blank">SQL</a> within HTML is well encouraged. groups of
mak:lists are nicely combined in a high-performance original way</li>
  <li>$attributes are transformed into $1 OQL attributes in an easy
transparent manner</li>
  <li>easy nesting of mak:lists and composing queries from them. this
seems to be very original to makumba<br>
  </li>
</ul>
<h3>design still not finished for</h3>
<ul>
  <li>parametrized query fragments
(especially in orderBy, etc). what should be allowed? should such
parameters (attributes) be expressed differently than nomral
$attributes which become normal OQL query $1 parameters? should they be
declared?</li>
  <li>an important application of the parametrization mentioned above
is search. there is little support for search forms today<br>
  </li>
</ul>
<h3>implementation status:</h3>
<ul>
  <li>the <a href="http://java.sun.com/products/jsp/reference/api/index.html" target="_blank">JSP taglib API</a> is still not enough
for makumba's needs. makumba-specific JSP page parsing needed to be
introduced in the last taglib version</li>
  <li>there are small features missing but the new architecture of
org.makumba.view.jsptaglib allows for easy extensions <br>
  </li>
  <li>the current implementation/architecture is very complex. maybe
JSP design should be actively lobbied? or should the ambitions be
reduced? maybe more research on JSP 2.0 (especially "simple tags") can
help solving this?<br>
  </li>
</ul>
<h3>3rd-party tools and standards:</h3>
<ul>
  <li>of course many tag libraries (incl the
standard <a href="http://java.sun.com/products/jsp/jstl/" target="_blank">JSTL</a>) know how to do
<a href="http://sqlzoo.net/" target="_blank">SQL</a> queries or display tables (<a href="http://java.sun.com/j2ee/javaserverfaces/index.jsp" target="_blank">JSF</a>) but none combine the two like
mak:list does (for better or worse)</li>
  <li>the taglib was designed for JSP 1.1, since then JSP 1.2 and
especially
2.0 added more features that, integrated in makumba, may simplify
makumba pages</li>
  <li>especially the Expression Language (EL) of JSP 2.0 makes it much
easier
to display values by using ${expression } notation</li>
  <li>JSTL helps replace java scriptlets. makumba should be integrated
more
with it<br>
  </li>
</ul>
<h2>forms</h2>
<h3>design status:</h3>
<ul>
  <li>keep nice familiarity with HTML, while
taking good advantage of the MDD information. this is a strength of
makumba design</li>
  <li>multiple forms are powerful and original<br>
  </li>
</ul>
<h3>design still not finished for</h3>
<ul>
  <li>form annotations</li>
  <li>expanding form interaction over more pages</li>
  <li>chooser flexibility<br>
  </li>
</ul>
<div style="margin-left: 40px;"></div>
<h3>implementation status</h3>
<ul>
  <li>see unfinished design above</li>
  <li>form responders are lost at webapp reload<br>
  </li>
</ul>
<h3>3rd-party tools and standards</h3>
<ul>
  <li><a href="http://java.sun.com/j2ee/javaserverfaces/index.jsp" target="_blank">JSF</a> (Java server faces) has excellent
design towards transforming web interaction into component-based
interaction. however, that goes too far into breaking the familiarity
with HTML forms, while bringing in a much less spread familiarity (GUI
component programming)<br>
  </li>
</ul>
<h2><span style="font-weight: bold;">MDD (data model)</span></h2>
<h3>design status</h3>
<ul>
  <li>a simple, easy to read,
database-neutral data description.</li>
  <li>a small number of types, that cover
most needs. more types would bring better performance, but create more
confusion</li>
  <li>some concepts could have better names (more related to db
theory): set,
internal set/pointer, etc<br>
  </li>
</ul>
<h3>design still not finished for</h3>
<ul>
  <li>the initial ambition was to be
object-oriented: encapsulation is more or less done, but inheritance
and polymorphism are still not addressed. is this really needed?</li>
  <li>subtyping (a database theory concept) is supported but can be
made more
explicit</li>
  <li>business rules. a data model should not only describe data, but
also
specify rules on how it can be created and changed<br>
  </li>
</ul>
<h3>implementation status</h3>
<ul>
  <li>the parser is a bit messy but it works</li>
  <li>multiple-field uniqueness still not done<br>
  </li>
</ul>
<h3>3rd-party tools and standards</h3>
<ul>
  <li>there is acute need for database theory
reading (to decide whether to have it object-oriented or keep it
relational, etc)</li>
  <li><a href="http://java.sun.com/products/jdo/" target="_blank">JDO</a> supports (in Java&nbsp; standard, there are other tools like
it) an
object-oriented way to describe data and deal with it, and make objects
persistent<br>
  </li>
</ul>
<h2><span style="font-weight: bold;">Database layer</span></h2>
<h3>design status</h3>
<ul>
  <li>a pretty straightforward API for
accessing MDD-generated tables in a database-neutral manner</li>
  <li>the Dictionary usage for data arguments is a bit heavy (needs
casts, is
not type-safe, etc)</li>
  <li>maybe Database should be really called Transaction, or Connection.</li>
  <li>maps MDDs to DB tables. when reading a non-makumba DB this is
especially useful</li>
  <li>maps makumba types on their best representation in the host DB
engine</li>
  <li>the API for sending arguments to queries and retrieving their
results using Dictionaries seems to be pretty heavy. Besides, it is not
type-safe.<br>
  </li>
</ul>
<h3>design still not finished for</h3>
<ul>
  <li>uncertainty about object-orientation
(see MDD)<br>
  </li>
</ul>
<h3>implementation status</h3>
<ul>
  <li>old, trusted code, using <a href="http://java.sun.com/products/jdbc/" target="_blank">JDBC</a> 1</li>
  <li>there is a discussion on whether to use foreign keys or not</li>
  <li>presently indexes are created for almost every field. this
results in
the <a href="http://sqlzoo.net/" target="_blank">SQL</a> engine not knowing which to use<br>
  </li>
</ul>
<h3>3rd-party tools and standards</h3>
<ul>
  <li>database-neutrality made lots of
progress in the past years. <a href="http://java.sun.com/products/jdo/" target="_blank">JDO</a>, <a href="http://java.sun.com/developer/earlyAccess/jdbc/index.html" target="_blank">JDBC Connector</a>, even <a href="http://java.sun.com/products/jdbc/" target="_blank">JDBC</a> itself&nbsp;
do much better then they used to. dropping the db layer for one of
these technologies could be very beneficial</li>
  <li>the <a href="http://java.sun.com/j2se/1.3/docs/api/index.html" target="_blank">JDBC API</a> (currently at version 3 and going towards version 4)
made
lots of progress since JDBC 1, most probably there are loads of
features that makumba does not take advantage of, including e.g. Rowsets<span
 style="font-weight: bold;"><br>
    </span></li>
</ul>
<h2><span style="font-weight: bold;">OQL </span><span
 style="font-weight: bold;"> (object query language)</span></h2>
<h3>design status</h3>
<ul>
  <li>specify queries in a database-neutral
manner. but this can increasingly be done in simple, standard <a href="http://sqlzoo.net/" target="_blank">SQL</a>.</li>
  <li>OQL is also used to translate from MDD names to DB table names in
queries (by calling the DB layer)</li>
  <li>we borrowed OQL
from the now defunct ODMG. the initial version of their <a href="http://www.cis.upenn.edu/~cis550/oql.pdf" target="_blank">OQL</a> grammar is
still on the makumba CVS. </li>
  <li>the ambition was to be object-oriented (see MDD)</li>
  <li>an important feature of makumba OQL that distinguishes it from
SQL is
the ability to refer sets easily (FROM general.Person p, p.addresses a
... instead of FROM general.Person p, general.Person-&gt;addresses a
WHERE a.person=p, though the second form should also work)</li>
  <li>another important feature is the ability to analyze queries,
including
type checking, useful during page analysis. even if we adopt a thrid
party technology, some form of query parsing will still be needed.<br>
  </li>
</ul>
<h3>design still not finished for</h3>
<ul>
  <li>functions. they should probably keep
the object oriented manner (object.call(arguments) )<br>
  </li>
</ul>
<h3>implementation status</h3>
<ul>
  <li>subqueries are badly missed</li>
  <li>patchy, hard to add new features. one should start fresh from the
original <a href="http://www.cis.upenn.edu/~cis550/oql.pdf" target="_blank">OQL</a> grammar and reimplement it to add functions and subqueries<br>
  </li>
</ul>
<h3>3rd-party tools and standards</h3>
<ul>
  <li>database-neutrality made lots of
progress in the past years. <a href="http://java.sun.com/products/jdo/" target="_blank">JDO</a> (which has its own form of OQL), JDBC
Connector, even JDBC itself&nbsp; do
much better then they used to. dropping or adapting <a href="http://www.cis.upenn.edu/~cis550/oql.pdf" target="_blank">OQL</a> for one of
these
technologies could be very beneficial. JDO is explicitely recommended
by ODMG as the natural place to go<br>
  </li>
</ul>
<h2>Login</h2>
<h3>design status</h3>
<ul>
  <li>based on "secret attributes".</li>
  <li>the design was so poor that it had to be patched with
"checkAttributes".</li>
  <li>the design led to a number of problems, including secret
attributes
with identical names in different parts of the site</li>
  <li>the design also hides the concept of session, which is important
to
learn (and use) for developers. sessions can be used for more than login<br>
  </li>
</ul>
<h3>3rd-party tools</h3>
<ul>
  <li>the servlet speficification itself has a
good login design, and that standard login (and the design of its
integration in makumba) should be looked at first</li>
  <li>there are other tools like <a href="http://oss.ipov.org/jsai/" target="_blank">jSai</a> that seem to work in this
department</li>
</ul>
<h2>"Business Logic"</h2>
<h3>design status</h3>
<ul>
  <li>bad design, mixture between logic and
controller.</li>
  <li>thus the "clean <a href="http://heim.ifi.uio.no/~trygver/themes/mvc/mvc-index.html" target="_blank">MVC</a>" part of the statement of purpose is still
not well
addressed</li>
  <li>it's clear that business rules should live with the data, maybe
in MDD
files, maybe near them.</li>
  <li>parts that are more dependent on the interface (on the way the
form was
shown, etc) should be part of the controller<br>
  </li>
</ul>
<h3>design still not finished for</h3>
<ul>
  <li>i think this part should be completely
restructured.</li>
  <li>stuff that does pure data processing should move to "data model"</li>
  <li>stuff that does data adaptation from and to the dialogs (forms)
should
go to the controller</li>
  <li>sessions should be visible to the model, the controller, or both <br>
  </li>
</ul>
<h3>3rd-party tools</h3>
<ul>
  <li>Jakarta <a href="http://struts.apache.org/" target="_blank">Struts</a>, <a href="http://java.sun.com/j2ee/javaserverfaces/index.jsp" target="_blank">JSF</a>, <a href="http://java.sun.com/products/ejb/" target="_blank">EJB</a> (e.g. for
session design)</li>
</ul>
<h2>Controller</h2>
<h3>design status:</h3>
<ul>
  <li>transparent for now. executes at every
page access, via a servlet filter</li>
</ul>
<h3>design still not finished for:</h3>
<ul>
  <li>see "business logic" above: stuff
that's
specific to the form should be specified in/near the JSP and executed
by the controller</li>
  <li>not able to show different pages after form submission ("view
selection")</li>
  <li>in general, not enough flexibility in treating the errors</li>
</ul>
<h3>3rd-party tools:</h3>
<ul>
  <li>Jakarta <a href="http://struts.apache.org/" target="_blank">Struts</a>,
<a href="http://java.sun.com/j2ee/javaserverfaces/index.jsp" target="_blank">JSF</a><br>
  </li>
</ul>
<h2>Developer tools</h2>
<h3>design status:</h3>
<ul>
  <li>pretty original, building on the
originality of MDD and JSP parts<br>
  </li>
</ul>
<h3>design still not finished for:</h3>
<ul>
  <li>interacting more with the
programming during development<br>
  </li>
</ul>
<h3>implementation status:</h3>
<ul>
  <li>"page summary" is still not
implemented, although the recent page analysis code makes it much easier</li>
  <li>"pages and BL classes affected by an MDD" still not implemented,
although most of the tools are in place (page analysis, etc)<br>
  </li>
</ul>
<h3>3rd-party tools</h3>
<ul>
  <li><a href="http://ant.apache.org/" target="_blank">Ant</a></li>
  <li><a href="http://www.eclipse.org/" target="_blank">Eclipse</a></li>
</ul>
<h2>Templates/Components<br>
</h2>
<h3>design status:</h3>
<ul>
  <li>none done<br>
  </li>
  <li>templating was really desired from the very begining of makumba.</li>
  <li>it becomes more and more important as it seems that "dynamic
website components" become pretty important on the net today, e.g. in
<a href="http://en.wikipedia.org/wiki/Content_management_system" target="_blank">CMS</a> systems</li>
  <li>included mechanisms can be a way to support templates. the
current support for include mechanisms (jsp:include and @include) do
not cross mak:list contexts. you can't have a mak:list and include
something within it which would</li>
  <ul>
    <li>be dynamic in name (i.e. decide what to include at runtime)</li>
    <li>know its context (i.e. know that it's included in a certain
type of mak:list)</li>
  </ul>
  <li>JSP 2.0 supports the definition of new tags in JSP files (tag
files) instead of Java classes.&nbsp; This can also support templating<br>
  </li>
</ul>
<h3>3rd-party tools</h3>
<ul>
  <li><a href="http://java.sun.com/developer/technicalArticles/javaserverpages/JSP20/" target="_blank">JSP 2.0 tag files</a></li>
  <li>&nbsp;<a href="http://www.PHPNuke.org/" target="_blank">PHPNuke</a> as an example</li>
</ul>
<h2>Internal architecture design<br>
</h2>
<h3>design status:</h3>
<ul>
  <li>this is not a very important part of design (is not affecting the
user) but it is important for sustaining makumba</li>
  <li>handler families seem to be problematic to understand and maintain</li>
  <li>there are automatic tests for the most critical part (database
layer) and for others (MDD, etc) but they are badly missed for the
taglib.<br>
  </li>
</ul>
<h3>design still not finished for:</h3>
<ul>
  <li>not sure how handler families could be redesigned</li>
</ul>
<h3>implementation status:</h3>
<h3>3rd-party tools</h3>
<ul>
  <li>Jakarta <a href="http://jakarta.apache.org/cactus/" target="_blank">Cactus</a> can help in making automatic tests for the JSP
taglib layer</li>
  <li><a href="http://www.eclipse.org/" target="_blank">Eclipse</a> can help refactoring<br>
  </li>
</ul>
</body>
</html>
