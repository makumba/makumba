<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="author" content="makumba-dev group">
  <title>Makumba Specification</title>
  <link rel="stylesheet" type="text/css" media="all" href="main.css">
  <script type="text/javascript" src="main.js"></script>
</head>
<body>
<script type="text/javascript">
   makeNavBar("");
</script>
<h1>Makumba Specification</h1>

<table>
  <tr>
    <td valign="top"> <a href="makumba-spec.html" title="...writing MDDs"><b>[Data Definitions]</b></a>&nbsp; </td>
    <td valign="top"> <a href="makumba-spec-ql.html" title="...getting data from the database"><b>[Query Languages]</b></a>&nbsp; </td>
    <td valign="top"> 
      <b>[<span title="...viewing/editing data thru HTML pages">JSP tag library</span>:</b>
      <a href="makumba-spec-taglib.html" title="...controller &amp; response"><b>Intro</b></a>
      | <a href="makumba-spec-taglib-list.html" title="...viewing data thru HTML pages"><b>Listing</b></a>
      | <a href="makumba-spec-taglib-forms.html" title="...editing data thru HTML pages"><b>Forms</b></a>]
    </td>     
    <td valign="top"> <a href="makumba-spec-bl.html" title="...adding logic to basic operations"><b>[Business Logics]</b></a>&nbsp; </td>
    <td valign="top"> <a href="makumba-spec-summary.html" title="...Presentation and internal representation principles"><b>[Summary]</b></a> </td>
  </tr>
</table>

<h2><a name="Presentation">Presentation with JSP taglib</a></h2>

<table widht=100%>
<tr>
  <td valign="top">
    <div class="navbarPage">
    <ul class="navbarPage">
      <li><a href="#controller">Makumba Controller</a></li>
      <br>
      <li><a href="#tagparameters">JSP tag parameters</a></li>
      <br>
      <li><a href="#response">&lt;mak:response/&gt;</a></li>
    </ul>
    </div>
  </td>
  <td>

Data can be presented and edited per record and field. The current
presentation
language uses JSP taglibs and corresponding notation, but principles
can
be applied in any other HTML-centric presentation language such as PHP.
<h3><a name="JspIntro">Makumba in Java Server Pages</a></h3>
Makumba offers a JSP custom tag library, that allows easy interaction
(viewing,
editing) with the data in your database, right from your HTML
(actually, JSP) document.
Since Makumba pages, are essentially JSP pages, a basic understanding
of JSP will
be helpful to make more advanced use of makumba. Same goes for knowing
a bit of Java itself.
But you can get a long way with just a few notions! Really.
<p>Makumba tags are written according to
<a href="http://java.sun.com/products/servlet/">Servlet 2.3
specification</a>
and <a href="http://java.sun.com/products/jsp/">JSP 1.1 specification</a>.
You will need a so-called "servlet container" that supports them both,
such as <a href="http://jakarta.apache.org/tomcat/">Apache Tomcat</a>.
The corresponding <b>WEB-INF/makumba.tld</b> is already included in
the <a href="download.html">distribution</a>
<code>makumba.jar</code>. The example <b>WEB-INF/web.xml</b> can be
found in Makumba <a
 href="http://cvs.sourceforge.net/viewcvs.py/*checkout*/makumba/makumba/servlet_context/WEB-INF/">cvs
repository</a>.
</p>
<p>Before using Makumba tags in your JSP pages you also need to declare
the taglib with:
</p>
<pre class="example">&lt;%@ taglib uri="http://www.makumba.org/presentation" prefix="mak" %&gt;<br></pre>
<p>A few resources on JSPs (don't be afraid to try first, read later) :
</p>
<ul>
  <li><a href="http://java.sun.com/products/jsp/docs.html">JSP
documentation by Sun</a> </li>
  <li><a href="http://java.sun.com/webservices/tutorial.html">J2EE web
services documentation by Sun</a>. This is an introduction on the
various technologies that you might use when building webapplications
using Java2 (J2EE). </li>
  <li><a
 href="http://www.apl.jhu.edu/%7Ehall/java/Servlet-Tutorial/Servlet-Tutorial-JSP.html">Gentle
introduction to JSPs</a> </li>
</ul>
<h4>
<a name="controller">Makumba Controller</a></h4>
<p>
The makumba controller is a component running in the 'servlet
container'.
When a request for a makumba page enters the servlet container,
the controller will intercept the request, and perform its "controller"
activities (cfr. the model-view-controller pattern) :
</p>
<ul>
  <li>checking if the page has the appropriate attributes (see handler
initialisation; e.g. force login). </li>
  <li>checking if the page request is the result of a form submit or a
deleteLink. If so, perform the relevant actions in the handler and
database. </li>
  <li>deal with problems (exceptions) during the controller activity:
    <ul>
      <li>if <a href="api/org/makumba/LogicException.html"><code>org.makumba.LogicException</code></a>
is thrown, the Exception can write a message to the <a href="#response"><code>&lt;mak:response&gt;</code></a>
in the requested page.</li>
      <li><a href="api/org/makumba/UnauthenticatedException.html"><code>org.makumba.UnauthenticatedException</code></a>
and <a href="api/org/makumba/UnauthorizedException.html"><code>org.makumba.UnauthorizedException</code></a>
will force login <span class="futfeat">(although UnauthorizedException
probably shouldn't, <a
 href="http://bugzilla.makumba.org/show_bug.cgi?id=444">bug 444</a>)</span></li>
      <li>if another exception occurs, an errorPage will be shown
instead of the requested page.</li>
    </ul>
  </li>
</ul>
<p>For this to work, the correct configuration must be applied in <code>WEB-INF/web.xml</code>
(<a
 href="http://cvs.sourceforge.net/viewcvs.py/*checkout*/makumba/makumba/servlet_context/WEB-INF/">example
file</a>).
The following would tell the makumba controller to filter all requests
for .jsp files.
</p>
<pre class="example">  &lt;filter&gt;<br>     &lt;filter-name&gt;makumba_controller&lt;/filter-name&gt;<br>     &lt;filter-class&gt;org.makumba.controller.http.ControllerFilter&lt;/filter-class&gt;<br>  &lt;/filter&gt;<br><br>  &lt;filter-mapping&gt;<br>    &lt;filter-name&gt;makumba_controller&lt;/filter-name&gt;<br>    &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;<br>  &lt;/filter-mapping&gt;<br></pre>
<p>
Note that if (in this example) the result page for a makumba form would
be an <code>.html</code> page, then the makumba controller would not
intercept
the <code>.html</code> page request, and the actions implied by the
form,
would not be performed.
</p>
<h4>
<a name="tagparameters">JSP tag parameters</a></h4>
<p>
JSP-tag parameter values are either <b>FIXED</b> or <b>RTEXPR</b>
(runtime expression).
A <b>FIXED</b> tag parameter must have a constant, literal value,
while an <b>RTEXPR</b>
can also be of the form &lt;%= java_expression %&gt;. On the other
hand, <i>some</i>
FIXED parameters can contain jsp attributes like $attr in makumba tags.
</p>
<p>
All parameters are <b>optional</b> unless specifically mentioned as
being <b>mandatory</b>.
</p>
<p> Specific concern can be the <b>parameter quoting</b>. Tag
parameters can be written as name="value" or name='value' (note: the
stringLiteral on DATE must be quoted with "). The choice of quote can
be determined by the need to use either double or single quote as part
of the value itself. If the quote is also present within the value, it
must be escaped by a backslash. </p>
<pre class="example">  &lt;mak:list from="general.Person p" where="p.gender=\"male\"" &gt;<br>  &lt;mak:list from="general.Person p" where='p.gender="male"' &gt;<br>  &lt;mak:list from="general.Person p" where="p.gender='male'" &gt;<br>  &lt;mak:list from="library.Book b" where="b.publisher=\"O'Reilly\" " &gt;    <!-- FIXME (fred) I'm not 100% sure this is correct --><br>  &lt;mak:list from="library.Book b" where='b.publisher="O\'Reilly" ' &gt;<br></pre>
<p>
Quotes in <b>extra HTML formatting</b> parameters, such as
<code>styleClass</code>, <code>title</code>, <code>styleId</code>, <code>onClick</code>
...
need some special attention with quotes.
The parameter values are copied verbatim (with no modifications by
makumba)
to the resulting HTML, always surrounded with double quotes (").
This means that you have to use other quotes, like single one ('),<br>
If you need to pass a literal <b>backslash</b> (\) you have to escape
it with a preceeding backslash (\\).
</p>
<pre class="example">  &lt;mak:input ... onClick="alert(this.value);"/&gt;<br>  &lt;mak:input ... onClick="alert('Hello world!');"/&gt;<br>  &lt;mak:input ... onClick="alert('Hello\\nWorld');"/&gt;<br></pre>
<p>
Unfortunately the idea to use a sequence of escapes,
eg writing \\\' in the JSP page to set the tag attribute to \',
which could be handy for javascript tag attributes,
is confusing the Tomcat servlet container.
</p>


<!-- ========================================================= -->
<!-- ====================== mak:response ===================== -->
<h3><a name="response">&lt;mak:response/&gt;</a></h3>
<p>
<code>&lt;mak:response/&gt;</code> prints information about the results
of the actions
that were performed by the <a href="#controller">makumba controller</a>
(e.g. for a form submit or deleteLink):
It either displays the <code>message="..."</code> parameter of the
form tag (in green)
in case of success,
or (in red) the message of a uncaught <code>LogicException</code>
resulting from
Business Logic. Other exception types will provoke an exception page.
<!-- Fred: not true:

<p>Absence of the &lt;mak:response/> tag on a page that is the response to a form, will result in an run-time error.

--></p>
<p>The unformatted message is available as request-scope attribute <code>makumba.response</code>.
The jsp page can get hold of the message using e.g. </p>
<pre class="example">&lt;% String s = (String) request.getAttribute("makumba.response") %&gt;<br></pre>
<p>
Similarly, request-scope attribute <code>makumba.successfulResponse</code>
is set
<i>only</i> in case of successful action execution.
</p>
<pre class="example">&lt;% if (null == request.getAttribute("makumba.successfulResponse")) { /* action failed */ } %&gt;<br></pre>
<p class="futfeat"> (A body-tag style (<code>&lt;mak:response&gt;...&lt;/mak:response&gt;</code>)
will be added later, to display different messages for different
circumstances (errors). It will also be possible to get hold of the
actual exception object. ) </p>

  </td>
</tr>
</table>

<script type="text/javascript">
   makeFooter("$Id$");
</script>
</body>
</html>
